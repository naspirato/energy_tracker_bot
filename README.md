# Telegram Psychology Bot

–≠—Ç–æ—Ç Telegram –±–æ—Ç –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∑–∞–ø–∏—Å—ã–≤–∞—è –¥–∞–Ω–Ω—ã–µ –≤ Google –¢–∞–±–ª–∏—Ü—ã.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
   ```bash
   python -m venv venv
   source venv/bin/activate  # –ù–∞ macOS/Linux
   # –∏–ª–∏
   venv\Scripts\activate  # –ù–∞ Windows
   ```
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   pip install -r requirements.txt
   ```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. Telegram Bot Token
–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ —É [@BotFather](https://t.me/BotFather) –∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```bash
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞_–æ—Ç_botfather
```

### 2. Google Sheets API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–î–ª—è —Ä–∞–±–æ—Ç—ã —Å Google –¢–∞–±–ª–∏—Ü–∞–º–∏:

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ [Google Cloud Console](https://console.cloud.google.com/)
2. –í–∫–ª—é—á–∏—Ç–µ Google Sheets API
3. –°–æ–∑–¥–∞–π—Ç–µ Service Account –∏ —Å–∫–∞—á–∞–π—Ç–µ JSON —Ñ–∞–π–ª —Å –∫–ª—é—á–∞–º–∏
4. –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ —Ñ–∞–π–ª –≤ `creds.json` –∏ –ø–æ–º–µ—Å—Ç–∏—Ç–µ –≤ –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
chmod +x manage.sh       # –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º (–æ–¥–∏–Ω —Ä–∞–∑)
./manage.sh start        # –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
./manage.sh stop         # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
./manage.sh restart      # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
./manage.sh status       # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
./manage.sh logs         # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
```bash
source venv/bin/activate
python run_local.py  # –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
# –∏–ª–∏
python bot.py        # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ
```

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
–í Telegram –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É:
- `/start` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏
- `/help` - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- `/setsheet <—Å—Å—ã–ª–∫–∞ –Ω–∞ Google —Ç–∞–±–ª–∏—Ü—É>` - –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É
- `/track` - –Ω–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- `/status` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É

### üéõÔ∏è –ö–Ω–æ–ø–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–¥–æ–±–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:
- **üìä –ó–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ** - –Ω–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **üìà –°—Ç–∞—Ç—É—Å** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
- **‚ùì –ü–æ–º–æ—â—å** - –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
- **üîó –ò–∑–º–µ–Ω–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É** - –ø–æ–¥–∫–ª—é—á–∏—Ç—å –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É

## –ö–æ–º–∞–Ω–¥—ã

- `/start` - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
- `/setsheet <—Å—Å—ã–ª–∫–∞>` - –ü–æ–¥–∫–ª—é—á–∏—Ç—å Google —Ç–∞–±–ª–∏—Ü—É
- `/track` - –ó–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ (—É—Å—Ç–∞–ª–æ—Å—Ç—å, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, —Å–æ–Ω)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

–ë–æ—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É —Å–ª–µ–¥—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ:
- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
- –£—Å—Ç–∞–ª–æ—Å—Ç—å (0-10)
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ (0-10)  
- –ö–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞ (—Ç–µ–∫—Å—Ç)

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ï—Å–ª–∏ —Ñ–∞–π–ª `creds.json` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –±–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ Google Sheets —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `usersheets.json`
- –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç aiogram v3 –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram API

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ TelegramConflictError
–ï—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫—É "can't use getUpdates method while webhook is active":
1. –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç webhook –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
2. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –∑–∞–ø—É—Å—Ç–∏—Ç–µ: `python delete_webhook.py`
3. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ BotFather –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è webhook: `/setwebhook` ‚Üí –ø—É—Å—Ç–∞—è —Å—Å—ã–ª–∫–∞

### –û—à–∏–±–∫–∞ "terminated by other getUpdates request"
–ï—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫—É "terminated by other getUpdates request":
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `./manage_bot.sh status` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `./manage_bot.sh stop` –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
3. –ò–ª–∏ –Ω–∞–π–¥–∏—Ç–µ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤—Ä—É—á–Ω—É—é: `ps aux | grep "python.*bot"` 